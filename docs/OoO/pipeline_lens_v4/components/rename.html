<!-- components/rename.html -->
<div id="renamePanel" class="card" style="display:none;">
  <div class="row" style="justify-content:space-between">
    <h3>Rename Panel</h3>
    <button id="btnCloseRename">Close</button>
  </div>

  <div class="small">
    Bu panel, rename aşamasını adım adım gösterir. Oluşan sonuçlar Apply to Main ile ana simülasyona aktarılır.
  </div>

  <div class="row" style="margin:8px 0">
    <button id="btnRenameStep">Run Rename Step</button>
    <button id="btnRenameAll">Rename All</button>
    <button id="btnRenameReset">Reset Rename</button>
    <button id="btnRenameApply">Apply to Main</button>
  </div>

  <div id="renameLog" class="mono small" style="margin-top:8px;max-height:300px;overflow:auto;background:var(--ink);padding:8px;border-radius:8px;border:1px solid var(--line)">
    <div style="color:gray;">No rename steps yet</div>
  </div>
</div>

<div id="overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);backdrop-filter:blur(2px);z-index:55;"></div>

<script>
/* Rename Panel logic (main simülasyondan çağrılır) */
let RP = null;

function openRename(state) {
  document.getElementById("overlay").style.display = "block";
  document.getElementById("renamePanel").style.display = "block";
  RP = buildInitialState(state.prog);
  document.getElementById("renameLog").textContent = "Ready for rename...";
}

function closeRename() {
  document.getElementById("overlay").style.display = "none";
  document.getElementById("renamePanel").style.display = "none";
  RP = null;
}

function renameStepUI(mainState) {
  if (!RP) return;
  if (RP.RS.length >= RP.prog.length) {
    document.getElementById("renameLog").textContent += "\\nAlready renamed all.";
    return;
  }
  const inst = RP.prog[RP.RS.length];
  const res = renameOne(RP, inst);
  document.getElementById("renameLog").textContent += "\\n" + res.line;
}

function renameAllUI() {
  if (!RP) return;
  const logs = renameAll(RP);
  document.getElementById("renameLog").textContent = logs.join("\\n");
}

function renameApplyToMain(mainState) {
  if (!RP) return;
  mainState.fmap = RP.fmap;
  mainState.free = RP.free;
  mainState.prf = RP.prf;
  mainState.prfReady = RP.prfReady;
  mainState.RS = RP.RS;
  mainState.ROB = RP.ROB;
  mainState.prfAllocCount = RP.prfAllocCount;
  renderAll();
  closeRename();
}

/* Button wiring (global olay bağlama) */
document.getElementById("btnCloseRename").onclick = () => closeRename();
document.getElementById("btnRenameStep").onclick = () => renameStepUI(S);
document.getElementById("btnRenameAll").onclick = () => renameAllUI();
document.getElementById("btnRenameReset").onclick = () => { RP = buildInitialState(S.prog); document.getElementById("renameLog").textContent = "Reset."; };
document.getElementById("btnRenameApply").onclick = () => renameApplyToMain(S);
document.getElementById("overlay").onclick = () => closeRename();
</script>
