{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CERES RISC-V Test Configuration",
  "description": "Configuration schema for test suites",
  "type": "object",
  "properties": {
    "$schema": { "type": "string" },
    "_comment": { "type": "string" },
    "_description": { "type": "string" },

    "test_list": {
      "type": "string",
      "description": "Path to the test list file (.flist) relative to project root"
    },

    "simulation": {
      "type": "object",
      "properties": {
        "max_cycles": { 
          "type": "integer", 
          "minimum": 1,
          "description": "Maximum simulation cycles before timeout"
        },
        "timeout_seconds": { 
          "type": "integer", 
          "minimum": 0,
          "description": "Wall-clock timeout in seconds (0 = disabled)"
        },
        "parallel_jobs": {
          "oneOf": [{"type": "integer", "minimum": 1}, {"const": "auto"}],
          "description": "Number of parallel test jobs"
        },
        "build_threads": {
          "oneOf": [{"type": "integer", "minimum": 1}, {"const": "auto"}],
          "description": "Number of threads for Verilator build (default: auto = nproc)"
        },
        "sim_threads": {
          "oneOf": [{"type": "integer", "minimum": 1}, {"const": "auto"}],
          "description": "Number of threads for simulation runtime (default: 1)"
        }
      }
    },

    "comparison": {
      "type": "object",
      "description": "RTL vs Spike comparison settings",
      "properties": {
        "enabled": { 
          "type": "boolean",
          "description": "Enable RTL vs Spike comparison"
        },
        "use_pass_fail_addr": { 
          "type": "boolean",
          "description": "Use pass/fail address detection (NO_ADDR=0 when true)"
        },
        "spike_enabled": {
          "type": "boolean",
          "description": "Run Spike golden model"
        }
      }
    },

    "defines": {
      "type": "object",
      "description": "SystemVerilog `define macros to enable",
      "properties": {
        "SIM_FAST": { 
          "type": "boolean",
          "description": "Fast simulation mode (disables all logs)"
        },
        "LOG_COMMIT": { 
          "type": "boolean",
          "description": "Enable Spike-compatible commit trace"
        },
        "LOG_PIPELINE": { 
          "type": "boolean",
          "description": "Enable Kanata pipeline trace"
        },
        "LOG_RAM": { 
          "type": "boolean",
          "description": "Enable RAM initialization messages"
        },
        "LOG_UART": { 
          "type": "boolean",
          "description": "Enable UART TX file logging"
        },
        "LOG_BP": { 
          "type": "boolean",
          "description": "Enable branch predictor statistics"
        },
        "LOG_BP_VERBOSE": { 
          "type": "boolean",
          "description": "Enable per-branch verbose logging"
        },
        "TRACE_KANATA": { 
          "type": "boolean",
          "description": "Enable Kanata pipeline visualizer"
        },
        "TRACE_INTERNAL": { 
          "type": "boolean",
          "description": "Enable internal debug signals"
        },
        "SIM_UART_MONITOR": { 
          "type": "boolean",
          "description": "UART monitoring + auto-stop (for benchmarks)"
        },
        "SIM_COVERAGE": { 
          "type": "boolean",
          "description": "Enable coverage collection"
        }
      },
      "additionalProperties": { "type": "boolean" }
    },

    "trace": {
      "type": "object",
      "description": "Waveform tracing settings",
      "properties": {
        "enabled": { 
          "type": "boolean",
          "description": "Enable waveform tracing"
        },
        "format": { 
          "enum": ["fst", "vcd"],
          "description": "Trace file format"
        },
        "depth": { 
          "type": "integer", 
          "minimum": 1,
          "description": "Signal hierarchy depth to trace"
        }
      }
    },

    "logging": {
      "type": "object",
      "description": "Runtime logging configuration",
      "properties": {
        "commit_trace": { 
          "type": "boolean",
          "description": "Log committed instructions"
        },
        "pipeline_log": { 
          "type": "boolean",
          "description": "Log pipeline stages"
        },
        "ram_log": { 
          "type": "boolean",
          "description": "Log memory accesses"
        },
        "uart_log": { 
          "type": "boolean",
          "description": "Log UART transactions"
        },
        "bp_log": { 
          "type": "boolean",
          "description": "Log branch predictions"
        },
        "verbose": { 
          "type": "boolean",
          "description": "Enable verbose output"
        }
      }
    },

    "spike": {
      "type": "object",
      "description": "Spike ISA Simulator configuration",
      "properties": {
        "_comment": { "type": "string" },
        "enabled": {
          "type": "boolean",
          "description": "Enable Spike simulation"
        },
        "isa": {
          "type": "string",
          "description": "RISC-V ISA string (e.g., rv32im_zicsr_zicntr_zifencei)"
        },
        "priv": {
          "enum": ["m", "mu", "msu"],
          "description": "RISC-V privilege modes supported"
        },
        "pc": {
          "type": "string",
          "description": "Override ELF entry point (hex address)"
        },
        "processors": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of processors to simulate"
        },
        "memory_mb": {
          "type": "integer",
          "minimum": 1,
          "description": "Target memory size in MiB"
        },
        "triggers": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of supported triggers"
        },
        "pmp_regions": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of PMP regions"
        },
        "pmp_granularity": {
          "type": "integer",
          "minimum": 4,
          "description": "PMP granularity in bytes"
        },
        "misaligned": {
          "type": "boolean",
          "description": "Support misaligned memory accesses"
        },
        "big_endian": {
          "type": "boolean",
          "description": "Use big-endian memory system"
        },
        "halted": {
          "type": "boolean",
          "description": "Start halted for debugger connection"
        },
        "log_commits": {
          "type": "boolean",
          "description": "Generate log of commit info"
        },
        "log_cache_miss": {
          "type": "boolean",
          "description": "Generate log of cache misses"
        },
        "debug_mode": {
          "type": "boolean",
          "description": "Enable interactive debug mode (-d)"
        },
        "instructions_limit": {
          "type": "integer",
          "minimum": 0,
          "description": "Stop after n instructions (0 = unlimited)"
        },
        "real_time_clint": {
          "type": "boolean",
          "description": "Increment CLINT time at real-time rate"
        },
        "blocksz": {
          "type": "integer",
          "description": "Cache block size for CMO operations"
        },
        "debug_module": {
          "type": "object",
          "description": "Debug module configuration",
          "properties": {
            "enabled": { "type": "boolean" },
            "progsize": { "type": "integer", "minimum": 0 },
            "datacount": { "type": "integer", "minimum": 0 },
            "sba_bits": { "type": "integer", "minimum": 0 },
            "auth": { "type": "boolean" },
            "dmi_rti": { "type": "integer", "minimum": 0 },
            "abstract_rti": { "type": "integer", "minimum": 0 },
            "no_hasel": { "type": "boolean" },
            "no_abstract_csr": { "type": "boolean" },
            "no_abstract_fpr": { "type": "boolean" },
            "no_halt_groups": { "type": "boolean" },
            "no_impebreak": { "type": "boolean" }
          }
        },
        "cache": {
          "type": "object",
          "description": "Cache model configuration (format: S:W:B)",
          "properties": {
            "enabled": { "type": "boolean" },
            "icache": { "type": "string" },
            "dcache": { "type": "string" },
            "l2cache": { "type": "string" }
          }
        }
      }
    },

    "build": {
      "type": "object",
      "description": "Build/compilation settings",
      "properties": {
        "mode": { 
          "enum": ["debug", "release", "profile"],
          "description": "Build optimization mode"
        },
        "opt_level": { 
          "enum": ["-O0", "-O1", "-O2", "-O3"],
          "description": "Compiler optimization level"
        },
        "rebuild": { 
          "type": "boolean",
          "description": "Force rebuild before running tests"
        }
      }
    },

    "report": {
      "type": "object",
      "description": "Test reporting settings",
      "properties": {
        "html_report": { 
          "type": "boolean",
          "description": "Generate HTML test report"
        },
        "save_logs": { 
          "type": "boolean",
          "description": "Preserve log files after test"
        },
        "save_waveform": { 
          "type": "boolean",
          "description": "Preserve waveform files after test"
        }
      }
    },

    "extends": {
      "type": "string",
      "description": "Inherit from another config file (e.g., 'default')"
    }
  },
  "additionalProperties": false
}
